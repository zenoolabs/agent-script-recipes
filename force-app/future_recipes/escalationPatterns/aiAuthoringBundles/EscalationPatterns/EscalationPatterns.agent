# EscalationPatterns
# Demonstrates how to escalate to a human agent using the connections block and @utils.escalate

config:
   agent_name: "EscalationPatterns"
   agent_label: "EscalationPatterns"
   description: "Demonstrates patterns for escalating to human agents"

connections:
   messaging:
      escalation_message: "I am connecting you with a human agent who can help you further."
      outbound_route_type: "OmniChannelFlow"
      outbound_route_name: "AgentSupportFlow"

variables:
   user_sentiment: mutable string = "neutral"
   retry_count: mutable number = 0

system:
   messages:
      welcome: "Hi! I'm here to help. If you need a human at any time, just ask."
      error: "I encountered an issue. Please try again."

   instructions: "You are a helpful support agent. Escalate to a human if you cannot help or if requested."

start_agent topic_selector:
   description: "Routes the conversation"
   
   reasoning:
      instructions:|
         Select the tool that best matches the user's message and conversation history. If it's unclear, make your best guess.
      actions:
         support: @utils.transition to @topic.general_support
            description: "General support topic"

topic general_support:
   description: "Provides general support and handles escalation"

   reasoning:
      instructions:->
         | I can help with general questions. 
           If the user seems frustrated or asks for a human, please escalate.
         
         if @variables.user_sentiment == "frustrated":
            | It seems I'm not able to help you effectively.

      actions:
         # Escalate to human
         escalate_to_human: @utils.escalate
            description: "Escalate the conversation to a human agent"
            available when @variables.user_sentiment == "frustrated" or @variables.retry_count > 2

