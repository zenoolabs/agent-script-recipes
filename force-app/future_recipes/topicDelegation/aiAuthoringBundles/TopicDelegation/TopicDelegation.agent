# TopicDelegation
# Demonstrates how to call a topic as a tool (delegation) rather than transitioning to it

config:
   agent_name: "TopicDelegation"
   agent_label: "TopicDelegation"
   description: "Demonstrates calling topics as tools"

variables:
   user_id: mutable string = "user123"
   
system:
   messages:
      welcome: "Hi! I can help you with account issues by consulting our specialist."
      error: "Something went wrong."
   instructions: "You are a helpful assistant."

start_agent topic_selector:
   description: "Main entry point"
   
   reasoning:
      instructions:|
         Select the tool that best matches the user's message and conversation history. If it's unclear, make your best guess.
      actions:
         start: @utils.transition to @topic.general_support

topic general_support:
   description: "General support topic that delegates to specialist"
   
   reasoning:
      instructions:->
         | I can help with general questions. 
           If you have a complex account issue, I'll consult our specialist.
           
           I will wait for the specialist to finish and then I'll summarize their findings for you.

      actions:
         # Topic Delegation Pattern
         # This calls the specialist topic as a sub-function/tool
         # Control returns here automatically after the specialist topic finishes
         consult_specialist: @topic.specialist_topic
            description: "Consult the specialist for complex account issues"
            available when @variables.user_id != ""

topic specialist_topic:
   description: "Specialist topic for deep analysis"
   
   actions:
      analyze_account:
         description: "Analyzes the account"
         inputs:
            userId: string
         outputs:
            status: string
         target: "flow://SpecialistAction"

   reasoning:
      instructions:->
         | I am the specialist. I will analyze the account.
         
         run @actions.analyze_account
            with userId=@variables.user_id
            
         | Analysis complete. Returning results.

      actions:
         analyze_account: @actions.analyze_account
            with userId=@variables.user_id
            # No transition needed - control returns to caller automatically when done

