# ConditionalLogicPatterns - Mastering If/Else Control Flow
# This agent demonstrates comprehensive conditional logic patterns

config:
   agent_name: "ConditionalLogicPatterns"
   agent_label: "ConditionalLogicPatterns"
   description: "Evaluates loan applications using complex conditional logic"

variables:
   applicant_name: mutable string = ""
      description: "Applicant's name"

   credit_score: mutable number = 0
      description: "Credit score (300-850)"

   annual_income: mutable number = 0
      description: "Annual income in dollars"

   loan_amount: mutable number = 0
      description: "Requested loan amount"

   employment_years: mutable number = 0
      description: "Years at current employer"

   has_collateral: mutable boolean = False
      description: "Whether applicant has collateral"

   approval_status: mutable string = ""
      description: "approved, rejected, or review_needed"

   interest_rate: mutable number = 0.0
      description: "Approved interest rate"

system:
   messages:
      welcome: "Welcome! I'll help evaluate your loan application."
      error: "Unable to process application. Please verify all information."

   instructions: "You are a loan evaluation assistant. Use clear logic to assess applications fairly and consistently."

start_agent topic_selector:
   description: "Welcome applicants and begin loan evaluation process"
   
   reasoning:
      instructions:|
         Select the tool that best matches the user's message and conversation history. If it's unclear, make your best guess.
      actions:
         start_evaluation: @utils.transition to @topic.loan_evaluation
            description: "Begin the loan evaluation with conditional logic"

topic loan_evaluation:
   description: "Evaluates loan applications with conditional logic"

   actions:
      calculate_debt_ratio:
         description: "Calculates debt-to-income ratio"
         inputs:
            income: number
            loan_amount: number
         outputs:
            ratio: number
         target: "flow://CalculateDebtRatio"

   reasoning:
      instructions:->
         # Complex conditional logic for loan approval
         | Loan Application Evaluation

         # Check if we have all required information
         if not @variables.applicant_name or @variables.credit_score == 0 or @variables.annual_income == 0 or @variables.loan_amount == 0:
            | Missing required information. Please provide applicant name, credit score, annual income, and loan amount.

         # Proceed with evaluation if we have all data
         if @variables.applicant_name and @variables.credit_score > 0 and @variables.annual_income > 0 and @variables.loan_amount > 0:
            
            # Simple if condition
            if @variables.credit_score < 580:
               set @variables.approval_status = "rejected"
               set @variables.interest_rate = 0
               | REJECTED: Credit score below minimum threshold (580).

            # if-else pattern
            if @variables.credit_score >= 580 and @variables.credit_score < 670:
               # Fair credit - conditional approval
               if @variables.has_collateral and @variables.employment_years >= 2:
                  set @variables.approval_status = "approved"
                  set @variables.interest_rate = 8.5
                  | APPROVED: Fair credit with collateral and stable employment.
                    Interest rate: 8.5%
               else:
                  set @variables.approval_status = "review_needed"
                  | REVIEW NEEDED: Fair credit requires collateral and 2+ years employment.

            # Multiple conditions with 'and'
            if @variables.credit_score >= 670 and @variables.credit_score < 740 and @variables.annual_income >= 40000:
               # Good credit
               set @variables.approval_status = "approved"
               set @variables.interest_rate = 6.5
               | APPROVED: Good credit score and income.
                 Interest rate: 6.5%

            # Multiple conditions with 'or'
            if @variables.credit_score >= 740 or (@variables.credit_score >= 670 and @variables.annual_income >= 100000):
               # Excellent credit OR good credit with high income
               set @variables.approval_status = "approved"
               set @variables.interest_rate = 4.5
               | APPROVED: Excellent qualifications.
                 Interest rate: 4.5%

            # Nested conditions
            if @variables.loan_amount > 100000:
               if @variables.credit_score >= 720 and @variables.annual_income >= 75000:
                  if @variables.employment_years >= 3 or @variables.has_collateral:
                     set @variables.approval_status = "approved"
                     | APPROVED: Large loan with strong qualifications.
                  else:
                     set @variables.approval_status = "review_needed"
                     | REVIEW NEEDED: Large loan requires 3+ years employment or collateral.
               else:
                  set @variables.approval_status = "rejected"
                  | REJECTED: Insufficient qualifications for large loan.

            # Comparison operators: ==, !=, >, <, >=, <=
            if @variables.credit_score >= 700 and @variables.loan_amount <= (@variables.annual_income + @variables.annual_income): # Multiply is not supported yet
               | âœ“ Loan amount is within safe debt-to-income ratio.

            if @variables.loan_amount > (@variables.annual_income + @variables.annual_income + @variables.annual_income): # Multiply is not supported yet
               set @variables.approval_status = "rejected"
               | REJECTED: Loan amount exceeds 3x annual income.

            # Logical operators: and, or, not
            if not @variables.has_collateral and @variables.credit_score < 700:
               | Warning: No collateral and credit below 700.

            if (@variables.credit_score >= 720 and @variables.employment_years >= 5) or (@variables.has_collateral and @variables.credit_score >= 650):
               | Applicant meets alternative qualification path.

         # Final status
         | Current Status: {!@variables.approval_status if @variables.approval_status else "Pending evaluation"}
         
         if @variables.approval_status == "approved":
            | Interest Rate: {!@variables.interest_rate}%


      actions:
         # Actions can also use available when for conditional access
         calculate_ratio: @actions.calculate_debt_ratio
            available when @variables.annual_income > 0 and @variables.loan_amount > 0
            with income=@variables.annual_income
            with loan_amount=@variables.loan_amount
